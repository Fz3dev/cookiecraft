<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cookie Consent - Test Complet</title>
  <link rel="stylesheet" href="../dist/cookiecraft.css?v=5">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 2rem;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      margin-top: 0;
      color: #667eea;
    }
    .control-group {
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .control-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #333;
    }
    .control-group select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
      background: white;
    }
    .btn-group {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }
    .btn {
      flex: 1;
      padding: 1rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary {
      background: #667eea;
      color: white;
    }
    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }
    .btn-secondary {
      background: #f3f4f6;
      color: #333;
    }
    .btn-secondary:hover {
      background: #e5e7eb;
    }
    .debug {
      margin-top: 2rem;
      padding: 1rem;
      background: #1a1a1a;
      color: #0f0;
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.875rem;
      max-height: 200px;
      overflow-y: auto;
    }
    .debug-line {
      margin: 0.25rem 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Test Complet - Cookie Consent</h1>

    <div class="control-group">
      <label for="banner-layout">Layout de la Banni√®re</label>
      <select id="banner-layout">
        <option value="bar">Bar (pleine largeur)</option>
        <option value="box">Box (compact)</option>
        <option value="floating" selected>Floating (tr√®s compact)</option>
      </select>
    </div>

    <div class="control-group">
      <label for="banner-position">Position de la Banni√®re</label>
      <select id="banner-position">
        <option value="bottom">Bottom</option>
        <option value="top">Top</option>
        <option value="center">Center</option>
        <option value="bottom-left">Bottom Left</option>
        <option value="bottom-right" selected>Bottom Right</option>
      </select>
    </div>

    <div class="control-group">
      <label for="preferences-position">Position de la Modal Pr√©f√©rences</label>
      <select id="preferences-position">
        <option value="center">Center (d√©faut)</option>
        <option value="bottom-left" selected>Bottom Left</option>
        <option value="bottom-right">Bottom Right</option>
        <option value="top-left">Top Left</option>
        <option value="top-right">Top Right</option>
      </select>
    </div>

    <div class="control-group">
      <label for="widget-enabled">Widget Permanent</label>
      <select id="widget-enabled">
        <option value="true" selected>Activ√©</option>
        <option value="false">D√©sactiv√©</option>
      </select>
    </div>

    <div class="control-group">
      <label for="widget-position">Position du Widget</label>
      <select id="widget-position">
        <option value="bottom-left" selected>Bottom Left</option>
        <option value="bottom-right">Bottom Right</option>
        <option value="top-left">Top Left</option>
        <option value="top-right">Top Right</option>
      </select>
    </div>

    <div class="btn-group">
      <button class="btn btn-primary" onclick="launchTest()">üöÄ Lancer le Test</button>
      <button class="btn btn-secondary" onclick="resetTest()">üîÑ Reset</button>
    </div>

    <div class="debug" id="debug">
      <div class="debug-line">üìã Console de d√©bogage...</div>
    </div>
  </div>

  <script src="../dist/cookiecraft.min.js?v=5"></script>
  <script>
    let currentConsent = null;

    function log(message) {
      const debug = document.getElementById('debug');
      const time = new Date().toLocaleTimeString();
      const line = document.createElement('div');
      line.className = 'debug-line';
      line.textContent = `[${time}] ${message}`;
      debug.appendChild(line);
      debug.scrollTop = debug.scrollHeight;
      console.log(message);
    }

    function resetTest() {
      log('üîÑ Reset...');

      // Destroy current instance
      if (currentConsent) {
        currentConsent.destroy();
        currentConsent = null;
        log('‚úÖ Instance d√©truite');
      }

      // Clean up DOM
      document.querySelectorAll('.cc-banner, .cc-modal, .cc-widget').forEach(el => {
        el.remove();
        log('üóëÔ∏è √âl√©ment supprim√©: ' + el.className);
      });

      // Clear storage
      localStorage.removeItem('cookiecraft_consent');
      log('üóëÔ∏è localStorage nettoy√©');

      // Clear debug
      document.getElementById('debug').innerHTML = '<div class="debug-line">üìã Console nettoy√©e</div>';
    }

    function launchTest() {
      resetTest();

      const layout = document.getElementById('banner-layout').value;
      const position = document.getElementById('banner-position').value;
      const preferencesPosition = document.getElementById('preferences-position').value;
      const showWidget = document.getElementById('widget-enabled').value === 'true';
      const widgetPosition = document.getElementById('widget-position').value;

      log('‚öôÔ∏è Configuration:');
      log(`  ‚Ä¢ Banner: ${layout} - ${position}`);
      log(`  ‚Ä¢ Preferences: ${preferencesPosition}`);
      log(`  ‚Ä¢ Widget: ${showWidget ? widgetPosition : 'd√©sactiv√©'}`);

      const config = {
        mode: 'opt-in',
        autoShow: false,
        revision: 1,
        gtmConsentMode: false,

        categories: {
          necessary: {
            enabled: true,
            readOnly: true,
            label: 'Essentiels',
            description: 'N√©cessaires au bon fonctionnement du site'
          },
          analytics: {
            enabled: false,
            readOnly: false,
            label: 'Statistiques',
            description: 'Pour comprendre comment vous utilisez notre site'
          },
          marketing: {
            enabled: false,
            readOnly: false,
            label: 'Marketing',
            description: 'Pour vous proposer du contenu personnalis√©'
          }
        },

        theme: 'light',
        primaryColor: '#667eea',
        layout: layout,
        position: position,
        preferencesPosition: preferencesPosition,
        showWidget: showWidget,
        widgetPosition: widgetPosition,

        translations: {
          title: 'üç™ Cookies et confidentialit√©',
          description: 'Nous utilisons des cookies pour am√©liorer votre exp√©rience.',
          preferencesTitle: '‚öôÔ∏è G√©rer mes cookies',
          privacyPolicyUrl: 'https://example.com/politique-confidentialite',
          privacyPolicyLabel: 'En savoir plus'
        },

        onAccept: (categories) => {
          log('‚úÖ Consentement accept√©');
          log('‚è≥ Widget devrait appara√Ætre dans 500ms...');
        },

        onReject: () => {
          log('‚ùå Consentement rejet√©');
          log('‚è≥ Widget devrait appara√Ætre dans 500ms...');
        }
      };

      try {
        currentConsent = new CookieCraft.CookieConsent(config);
        log('‚úÖ Instance cr√©√©e');

        currentConsent.init();
        log('‚úÖ Instance initialis√©e');

        currentConsent.show();
        log('‚úÖ Banni√®re affich√©e');

        // Listen for widget
        setTimeout(() => {
          const widget = document.querySelector('.cc-widget');
          if (widget) {
            log('‚úÖ Widget trouv√© dans le DOM!');
            log('   Style: ' + widget.style.cssText);
            log('   Classes: ' + widget.className);
          } else {
            log('‚ùå Widget introuvable dans le DOM');
          }
        }, 1000);

      } catch (error) {
        log('‚ùå Erreur: ' + error.message);
        console.error(error);
      }
    }
  </script>
</body>
</html>
