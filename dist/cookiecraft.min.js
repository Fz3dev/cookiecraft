!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CookieCraft={})}(this,function(t){"use strict";class e{constructor(t){this.config=t}validateConsent(t){if(!t.necessary)return!1;for(const e of Object.keys(t))if(!(e in this.config.categories))return!1;return!0}updateConsent(t){if(!this.validateConsent(t))throw Error("Invalid consent categories");return this.consent=this.createConsentRecord(t),this.consent}needsConsent(){return void 0===this.consent}needsUpdate(t){return t.version<this.config.revision}getCurrentConsent(){return this.consent}createConsentRecord(t){const e=new Date,n=new Date(e);return n.setMonth(n.getMonth()+13),{version:this.config.revision,timestamp:e.toISOString(),categories:Object.assign({},t),userAgent:navigator.userAgent,expiresAt:n.toISOString()}}}class n{save(t){try{localStorage.setItem(n.STORAGE_KEY,JSON.stringify(t))}catch(t){console.error("Failed to save consent:",t)}}load(){try{const t=localStorage.getItem(n.STORAGE_KEY);if(!t)return null;const e=JSON.parse(t);if(!this.validateSchema(e)){const t=this.migrate(e);return t?(this.save(t),t):null}return e}catch(t){return console.error("Failed to load consent:",t),null}}clear(){localStorage.removeItem(n.STORAGE_KEY)}isExpired(t){return new Date(t.expiresAt)<new Date}validateSchema(t){return t&&"number"==typeof t.version&&"string"==typeof t.timestamp&&"object"==typeof t.categories&&"string"==typeof t.userAgent&&"string"==typeof t.expiresAt}migrate(t){return null}}n.STORAGE_KEY="cookiecraft_consent",n.EXPIRY_MONTHS=13;class i{constructor(){this.events=new Map}on(t,e){this.events.has(t)||this.events.set(t,new Set),this.events.get(t).add(e)}off(t,e){this.events.has(t)&&this.events.get(t).delete(e)}emit(t,e){this.events.has(t)&&this.events.get(t).forEach(n=>{try{n(e)}catch(e){console.error(`Error in event handler for ${t}:`,e)}})}clear(){this.events.clear()}clearEvent(t){this.events.delete(t)}}class s{constructor(t,e){this.observer=null,this.blockedScripts=new Map,this.currentConsent=null,this.categoryManager=t,this.eventEmitter=e}init(){this.blockExistingScripts(),this.observeDOM()}block(){this.currentConsent=null,this.blockExistingScripts()}unblock(t){this.currentConsent=t,this.blockedScripts.forEach((e,n)=>{const i=this.categoryManager.getCategoryForScript(e);i&&this.categoryManager.isAllowed(i,t)&&(this.reactivateScript(e),this.blockedScripts.delete(n))})}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null)}blockExistingScripts(){document.querySelectorAll("script[data-cookieconsent]").forEach(t=>{t instanceof HTMLScriptElement&&this.processScript(t)})}observeDOM(){this.observer=new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{t instanceof HTMLScriptElement&&t.hasAttribute("data-cookieconsent")&&this.processScript(t)})})}),this.observer.observe(document.documentElement,{childList:!0,subtree:!0})}processScript(t){const e=this.categoryManager.getCategoryForScript(t);if(e&&!(this.currentConsent&&this.categoryManager.isAllowed(e,this.currentConsent)||"text/plain"===t.type)){const e=this.generateScriptId(t);t.setAttribute("data-original-type",t.type||"text/javascript"),t.type="text/plain",this.blockedScripts.set(e,t)}}reactivateScript(t){const e=document.createElement("script");Array.from(t.attributes).forEach(t=>{"type"!==t.name&&"data-original-type"!==t.name&&e.setAttribute(t.name,t.value)});const n=t.getAttribute("data-original-type")||"text/javascript";e.type=n,t.src?e.src=t.src:e.textContent=t.textContent,t.parentNode&&(t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t)),this.eventEmitter.emit("script:activated",{category:t.getAttribute("data-cookieconsent"),src:t.src||"inline"})}generateScriptId(t){return t.src||`inline-${Date.now()}-${Math.random()}`}}class o{constructor(){this.categories=new Map,this.initializeDefaultPatterns()}registerCategory(t,e){this.categories.set(t,e)}getCategoryForScript(t){const e=t.getAttribute("data-cookieconsent");if(e)return e;const n=t.src;if(!n)return null;for(const[t,e]of this.categories)if(e.some(t=>n.includes(t)))return t;return null}isAllowed(t,e){return!0===e[t]}initializeDefaultPatterns(){this.categories.set("analytics",["google-analytics.com","googletagmanager.com","analytics.google.com","plausible.io","matomo.org","hotjar.com","mixpanel.com","segment.com","amplitude.com"]),this.categories.set("marketing",["facebook.net","facebook.com/tr","connect.facebook.net","doubleclick.net","ads.google.com","linkedin.com/analytics","twitter.com/i/adsct","pinterest.com/ct","adroll.com","taboola.com","outbrain.com"]),this.categories.set("necessary",[])}}class c{constructor(t,e){this.element=null,this.config=t,this.eventEmitter=e}show(){var t;this.element||(this.element=this.createDOM(),document.body.appendChild(this.element),this.attachListeners()),requestAnimationFrame(()=>{var t;null===(t=this.element)||void 0===t||t.classList.add("is-visible")});const e=null===(t=this.element)||void 0===t?void 0:t.querySelector("button");null==e||e.focus(),this.config.disablePageInteraction&&(document.body.style.overflow="hidden")}hide(){var t;null===(t=this.element)||void 0===t||t.classList.remove("is-visible"),this.config.disablePageInteraction&&(document.body.style.overflow=""),setTimeout(()=>{this.destroy()},300)}destroy(){this.element&&(this.element.remove(),this.element=null)}createDOM(){const t=this.config.translations||{},e=`\n      <div\n        class="cc-banner cc-banner--${this.config.position||"bottom"} cc-banner--${this.config.layout||"bar"} ${!1!==this.config.backdropBlur?"cc-backdrop-blur":""}"\n        role="region"\n        aria-label="Cookie consent"\n        aria-live="polite"\n        data-theme="${this.config.theme||"light"}"\n        style="${this.config.primaryColor?`--cc-primary: ${this.config.primaryColor};`:""}"\n      >\n        <div class="cc-banner__container">\n          <div class="cc-banner__content">\n            <h2 class="cc-banner__title">\n              ${t.title||"üç™ Nous utilisons des cookies"}\n            </h2>\n            <p class="cc-banner__description">\n              ${this.getDescriptionHTML()}\n            </p>\n          </div>\n          <div class="cc-banner__actions">\n            <button\n              class="cc-btn cc-btn--secondary"\n              data-action="reject"\n              aria-label="Rejeter tous les cookies"\n            >\n              ${t.rejectAll||"Tout rejeter"}\n            </button>\n            <button\n              class="cc-btn cc-btn--tertiary"\n              data-action="customize"\n              aria-label="Personnaliser les pr√©f√©rences"\n            >\n              ${t.customize||"Personnaliser"}\n            </button>\n            <button\n              class="cc-btn cc-btn--primary"\n              data-action="accept"\n              aria-label="Accepter tous les cookies"\n            >\n              ${t.acceptAll||"Tout accepter"}\n            </button>\n          </div>\n        </div>\n      </div>\n    `,n=document.createElement("div");return n.innerHTML=e.trim(),n.firstChild}attachListeners(){var t,e;null===(t=this.element)||void 0===t||t.addEventListener("click",t=>{switch(t.target.getAttribute("data-action")){case"accept":this.handleAcceptAll();break;case"reject":this.handleRejectAll();break;case"customize":this.handleCustomize()}}),null===(e=this.element)||void 0===e||e.addEventListener("keydown",t=>{"Escape"===t.key&&this.config.disablePageInteraction&&this.handleRejectAll()})}handleAcceptAll(){var t,e;const n={necessary:!0,analytics:!0,marketing:!0};this.config.categories.preferences&&(n.preferences=!0),this.eventEmitter.emit("consent:accept",n),null===(e=(t=this.config).onAccept)||void 0===e||e.call(t,n),this.hide()}handleRejectAll(){var t,e;const n={necessary:!0,analytics:!1,marketing:!1};this.config.categories.preferences&&(n.preferences=!1),this.eventEmitter.emit("consent:reject",n),null===(e=(t=this.config).onReject)||void 0===e||e.call(t),this.hide()}handleCustomize(){this.eventEmitter.emit("preferences:show"),this.hide()}getDescriptionHTML(){const t=this.config.translations||{},e=t.description||"Pour am√©liorer votre exp√©rience sur notre site, nous utilisons des cookies. Vous pouvez choisir les cookies que vous acceptez.";return t.privacyPolicyUrl?`${e} <a href="${t.privacyPolicyUrl}" target="_blank" rel="noopener noreferrer">${t.privacyPolicyLabel||"Politique de confidentialit√©"}</a>`:e}}class a{constructor(t,e,n){this.element=null,this.config=t,this.eventEmitter=e,this.currentConsent=n}show(){this.element||(this.element=this.createDOM(),document.body.appendChild(this.element),this.attachListeners()),this.element.classList.add("is-visible"),this.trapFocus(),document.body.style.overflow="hidden"}hide(){var t;null===(t=this.element)||void 0===t||t.classList.remove("is-visible"),document.body.style.overflow="",setTimeout(()=>{this.destroy()},300)}destroy(){this.element&&(this.element.remove(),this.element=null)}createDOM(){const t=this.config.translations||{},e=`\n      <div\n        class="cc-modal cc-modal--${this.config.preferencesPosition||"center"}"\n        role="dialog"\n        aria-modal="true"\n        aria-labelledby="cc-modal-title"\n        data-theme="${this.config.theme||"light"}"\n      >\n        <div class="cc-modal__overlay" data-action="close"></div>\n        <div class="cc-modal__content">\n          <div class="cc-modal__header" style="${this.config.primaryColor?`--cc-primary: ${this.config.primaryColor}; --cc-primary-hover: ${this.adjustColorBrightness(this.config.primaryColor,-15)};`:""}">\n            <h2 id="cc-modal-title">\n              ${t.preferencesTitle||t.title||"Pr√©f√©rences de cookies"}\n            </h2>\n            <button\n              class="cc-modal__close"\n              aria-label="Fermer"\n              data-action="close"\n            >\n              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">\n                <path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round"/>\n              </svg>\n            </button>\n          </div>\n\n          <div class="cc-modal__body">\n            ${this.renderCategories()}\n          </div>\n\n          <div class="cc-modal__footer">\n            <div class="cc-modal__footer-links">\n              ${t.privacyPolicyUrl?`\n                <a href="${t.privacyPolicyUrl}" target="_blank" rel="noopener noreferrer" class="cc-privacy-link">\n                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>\n                    <polyline points="15 3 21 3 21 9"/>\n                    <line x1="10" y1="14" x2="21" y2="3"/>\n                  </svg>\n                  ${t.privacyPolicyLabel||"Politique de confidentialit√©"}\n                </a>\n              `:""}\n            </div>\n            <div class="cc-modal__footer-actions">\n              <button\n                class="cc-btn cc-btn--secondary"\n                data-action="reject"\n              >\n                ${t.rejectAll||"Tout rejeter"}\n              </button>\n              <button\n                class="cc-btn cc-btn--primary"\n                data-action="save"\n              >\n                ${t.savePreferences||"Sauvegarder"}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `,n=document.createElement("div");return n.innerHTML=e.trim(),n.firstChild}renderCategories(){return Object.entries(this.config.categories).map(([t,e])=>{const n=e.readOnly;return`\n        <div class="cc-category">\n          <div class="cc-category__header">\n            <label class="cc-toggle ${n?"cc-toggle--disabled":""}">\n              <input\n                type="checkbox"\n                data-category="${t}"\n                ${this.currentConsent[t]?"checked":""}\n                ${n?"disabled":""}\n                aria-label="${e.label} cookies"\n              >\n              <span class="cc-toggle__slider"></span>\n            </label>\n            <div class="cc-category__info">\n              <h3>${e.label}</h3>\n              <p>${e.description}</p>\n            </div>\n          </div>\n        </div>\n      `}).join("")}attachListeners(){var t,e;null===(t=this.element)||void 0===t||t.addEventListener("click",t=>{const e=t.target.getAttribute("data-action");"close"===e?this.hide():"save"===e?this.handleSave():"reject"===e&&this.handleRejectAll()}),null===(e=this.element)||void 0===e||e.addEventListener("keydown",t=>{"Escape"===t.key&&this.hide()})}handleSave(){var t,e,n;const i=null===(t=this.element)||void 0===t?void 0:t.querySelectorAll("input[data-category]"),s={necessary:!0,analytics:!1,marketing:!1};null==i||i.forEach(t=>{if(t instanceof HTMLInputElement){const e=t.getAttribute("data-category");e&&(s[e]=t.checked)}}),this.eventEmitter.emit("consent:update",s),null===(n=(e=this.config).onChange)||void 0===n||n.call(e,s),this.hide()}handleRejectAll(){const t={necessary:!0,analytics:!1,marketing:!1};this.config.categories.preferences&&(t.preferences=!1),this.eventEmitter.emit("consent:reject",t),this.hide()}trapFocus(){var t,e;const n=null===(t=this.element)||void 0===t?void 0:t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!n||0===n.length)return;const i=n[0],s=n[n.length-1];null==i||i.focus(),null===(e=this.element)||void 0===e||e.addEventListener("keydown",t=>{"Tab"===t.key&&(t.shiftKey&&document.activeElement===i?(t.preventDefault(),s.focus()):t.shiftKey||document.activeElement!==s||(t.preventDefault(),i.focus()))})}adjustColorBrightness(t,e){const n=t.replace("#",""),i=parseInt(n.substring(0,2),16),s=parseInt(n.substring(2,4),16),o=parseInt(n.substring(4,6),16),c=t=>Math.max(0,Math.min(255,Math.round(t+t*e/100))),a=t=>{const e=t.toString(16);return 1===e.length?"0"+e:e};return`#${a(c(i))}${a(c(s))}${a(c(o))}`}}class r{constructor(t,e){this.element=null,this.isVisible=!1,this.config=t,this.eventEmitter=e}show(){console.log("üéØ FloatingWidget.show() called"),this.element||(this.element=this.createDOM(),document.body.appendChild(this.element),this.attachListeners(),console.log("‚úÖ Widget element created and appended to body")),requestAnimationFrame(()=>{var t;null===(t=this.element)||void 0===t||t.classList.add("is-visible"),this.isVisible=!0,console.log("‚úÖ Widget is-visible class added")})}hide(){var t;null===(t=this.element)||void 0===t||t.classList.remove("is-visible"),this.isVisible=!1}destroy(){this.element&&(this.element.remove(),this.element=null),this.isVisible=!1}getIsVisible(){return this.isVisible}createDOM(){const t=this.config.translations||{},e=`\n      <div\n        class="cc-widget cc-widget--${this.config.widgetPosition||"bottom-right"}"\n        role="button"\n        aria-label="${t.cookieSettings||"Param√®tres des cookies"}"\n        tabindex="0"\n        data-theme="${this.config.theme||"light"}"\n        style="${this.config.primaryColor?`--cc-primary: ${this.config.primaryColor};`:""}"\n      >\n        <svg class="cc-widget__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">\n          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>\n          <circle cx="12" cy="12" r="2"/>\n          <circle cx="7" cy="7" r="1.5"/>\n          <circle cx="17" cy="7" r="1.5"/>\n          <circle cx="7" cy="17" r="1.5"/>\n          <circle cx="17" cy="17" r="1.5"/>\n        </svg>\n        <span class="cc-widget__text">\n          ${t.cookies||"Cookies"}\n        </span>\n      </div>\n    `,n=document.createElement("div");return n.innerHTML=e.trim(),n.firstChild}attachListeners(){var t,e;null===(t=this.element)||void 0===t||t.addEventListener("click",()=>{this.handleClick()}),null===(e=this.element)||void 0===e||e.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.handleClick())})}handleClick(){this.eventEmitter.emit("preferences:show")}}class l{constructor(t){this.dataLayerManager=t}setDefaultConsent(){this.dataLayerManager.push("consent","default",{ad_storage:"denied",ad_user_data:"denied",ad_personalization:"denied",analytics_storage:"denied",functionality_storage:"denied",personalization_storage:"denied",security_storage:"granted"})}updateConsent(t){const e=this.mapCategoriesToGTM(t);this.dataLayerManager.push("consent","update",e)}mapCategoriesToGTM(t){return{ad_storage:t.marketing?"granted":"denied",ad_user_data:t.marketing?"granted":"denied",ad_personalization:t.marketing?"granted":"denied",analytics_storage:t.analytics?"granted":"denied",functionality_storage:t.preferences?"granted":"denied",personalization_storage:t.preferences?"granted":"denied",security_storage:"granted"}}}class h{push(t,e,n){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"consent_update",[t]:{[e]:n}}),"function"==typeof window.gtag&&window.gtag(t,e,n)}}class d{constructor(t){this.banner=null,this.preferenceCenter=null,this.floatingWidget=null,this.gtmIntegration=null,this.config=this.validateConfig(t),this.consentManager=new e(this.config),this.storageManager=new n,this.eventEmitter=new i,this.scriptBlocker=new s(new o,this.eventEmitter),this.config.gtmConsentMode&&(this.gtmIntegration=new l(new h)),this.eventEmitter.on("preferences:show",()=>{this.showPreferences()}),this.eventEmitter.on("consent:accept",t=>{this.updateConsent(t)}),this.eventEmitter.on("consent:reject",t=>{this.updateConsent(t)}),this.eventEmitter.on("consent:update",t=>{this.updateConsent(t)})}init(){this.scriptBlocker.init(),this.gtmIntegration&&this.gtmIntegration.setDefaultConsent();const t=this.storageManager.load();t&&!this.storageManager.isExpired(t)?this.consentManager.needsUpdate(t)?this.config.autoShow&&this.showBanner():(this.applyConsent(t.categories),this.eventEmitter.emit("consent:load",t),this.config.showWidget&&this.showFloatingWidget()):this.config.autoShow&&this.showBanner(),this.eventEmitter.emit("consent:init")}show(){this.showBanner()}hide(){var t;null===(t=this.banner)||void 0===t||t.hide()}showPreferences(){var t;const e=(null===(t=this.storageManager.load())||void 0===t?void 0:t.categories)||{necessary:!0,analytics:!1,marketing:!1,preferences:!1};this.preferenceCenter&&this.preferenceCenter.destroy(),this.preferenceCenter=new a(this.config,this.eventEmitter,e),this.preferenceCenter.show()}updateConsent(t){const e=this.consentManager.updateConsent(t);this.storageManager.save(e),this.applyConsent(t),this.gtmIntegration&&this.gtmIntegration.updateConsent(t),this.config.showWidget?(console.log("‚è≥ Widget will show in 400ms..."),setTimeout(()=>{console.log("üöÄ Calling showFloatingWidget()"),this.showFloatingWidget()},400)):console.log("‚ùå Widget disabled in config")}getConsent(){return this.storageManager.load()}reset(){this.storageManager.clear(),this.scriptBlocker.block(),this.showBanner()}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}destroy(){var t,e,n,i;null===(t=this.banner)||void 0===t||t.destroy(),this.banner=null,null===(e=this.preferenceCenter)||void 0===e||e.destroy(),this.preferenceCenter=null,null===(n=this.floatingWidget)||void 0===n||n.destroy(),this.floatingWidget=null,null===(i=this.scriptBlocker)||void 0===i||i.destroy()}showBanner(){this.banner||(this.banner=new c(this.config,this.eventEmitter)),this.banner.show(),this.eventEmitter.emit("consent:show")}showFloatingWidget(){this.floatingWidget||(this.floatingWidget=new r(this.config,this.eventEmitter)),this.floatingWidget.show()}applyConsent(t){this.scriptBlocker.unblock(t)}validateConfig(t){return Object.assign(Object.assign({},t),{mode:t.mode||"opt-in",autoShow:void 0===t.autoShow||t.autoShow,revision:t.revision||1,gtmConsentMode:t.gtmConsentMode||!1,disablePageInteraction:t.disablePageInteraction||!1,theme:t.theme||"light",position:t.position||"bottom",layout:t.layout||"bar",backdropBlur:!1!==t.backdropBlur,animationStyle:t.animationStyle||"smooth",preferencesPosition:t.preferencesPosition||"center",showWidget:void 0===t.showWidget||t.showWidget,widgetPosition:t.widgetPosition||"bottom-right"})}}t.CookieConsent=d,t.default=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=cookiecraft.min.js.map
